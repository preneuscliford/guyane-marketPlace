=================================================================
                DOCUMENTATION S√âCURIT√â RLS SUPABASE
                    Guyane Marketplace Application
=================================================================

Date de configuration : D√©cembre 2024
Projet Supabase : guyane-marketplace (ID: oidmaqovylsvbewsrlcb)

=================================================================
                        R√âSUM√â G√âN√âRAL
=================================================================

‚úÖ TOUTES LES TABLES SONT MAINTENANT S√âCURIS√âES AVEC RLS
‚úÖ TOUS LES BUCKETS DE STOCKAGE SONT S√âCURIS√âS
‚úÖ TOUTES LES FONCTIONS ONT DES SEARCH_PATH S√âCURIS√âS
‚úÖ POLITIQUES GRANULAIRES POUR CHAQUE OP√âRATION (SELECT, INSERT, UPDATE, DELETE)

Principe de s√©curit√© appliqu√© :
- Lecture publique : Contenu visible par tous (posts, produits, annonces)
- Gestion personnelle : Chaque utilisateur ne peut modifier que ses propres donn√©es
- Acc√®s contr√¥l√© : Conversations et messages limit√©s aux participants
- Stockage s√©curis√© : Upload authentifi√© avec gestion personnelle des fichiers

=================================================================
                    TABLES S√âCURIS√âES AVEC RLS
=================================================================

üìä TABLES DE PROFILS ET UTILISATEURS
-----------------------------------

1. TABLE : profiles
   - RLS : ACTIV√â
   - Politiques :
     * "Public profiles are viewable by everyone" (SELECT) : Profils publics visibles par tous
     * "Users can view own profile" (SELECT) : Utilisateurs peuvent voir leur propre profil
     * "Users can update own profile" (UPDATE) : Utilisateurs peuvent modifier leur profil
     * "Users can insert own profile" (INSERT) : Utilisateurs peuvent cr√©er leur profil

üõí TABLES DE MARKETPLACE
------------------------

2. TABLE : announcements
   - RLS : ACTIV√â
   - Politiques :
     * "Announcements are viewable by everyone" (SELECT) : Annonces visibles par tous
     * "Users can insert own announcements" (INSERT) : Utilisateurs peuvent cr√©er leurs annonces
     * "Users can update own announcements" (UPDATE) : Utilisateurs peuvent modifier leurs annonces
     * "Users can delete own announcements" (DELETE) : Utilisateurs peuvent supprimer leurs annonces

3. TABLE : products
   - RLS : ACTIV√â
   - Politiques :
     * "Products are viewable by everyone" (SELECT) : Produits visibles par tous
     * "Users can insert own products" (INSERT) : Utilisateurs peuvent cr√©er leurs produits
     * "Users can update own products" (UPDATE) : Utilisateurs peuvent modifier leurs produits
     * "Users can delete own products" (DELETE) : Utilisateurs peuvent supprimer leurs produits

4. TABLE : categories
   - RLS : ACTIV√â
   - Politiques :
     * "Categories are viewable by everyone" (SELECT) : Cat√©gories visibles par tous (lecture seule)
     * Note : Seuls les administrateurs peuvent modifier les cat√©gories

üë• TABLES DE COMMUNAUT√â
-----------------------

5. TABLE : posts
   - RLS : ACTIV√â
   - Politiques :
     * "Posts are viewable by everyone" (SELECT) : Posts visibles par tous
     * "Users can insert own posts" (INSERT) : Utilisateurs peuvent cr√©er leurs posts
     * "Users can update own posts" (UPDATE) : Utilisateurs peuvent modifier leurs posts
     * "Users can delete own posts" (DELETE) : Utilisateurs peuvent supprimer leurs posts

6. TABLE : comments
   - RLS : ACTIV√â
   - Politiques :
     * "Comments are viewable by everyone" (SELECT) : Commentaires visibles par tous
     * "Users can insert own comments" (INSERT) : Utilisateurs peuvent cr√©er leurs commentaires
     * "Users can update own comments" (UPDATE) : Utilisateurs peuvent modifier leurs commentaires
     * "Users can delete own comments" (DELETE) : Utilisateurs peuvent supprimer leurs commentaires

7. TABLE : likes
   - RLS : ACTIV√â
   - Politiques :
     * "Likes are viewable by everyone" (SELECT) : Likes visibles par tous
     * "Users can insert own likes" (INSERT) : Utilisateurs peuvent ajouter leurs likes
     * "Users can delete own likes" (DELETE) : Utilisateurs peuvent supprimer leurs likes

8. TABLE : favorites
   - RLS : ACTIV√â
   - Politiques :
     * "Users can view own favorites" (SELECT) : Utilisateurs peuvent voir leurs favoris
     * "Users can insert own favorites" (INSERT) : Utilisateurs peuvent ajouter des favoris
     * "Users can delete own favorites" (DELETE) : Utilisateurs peuvent supprimer leurs favoris

9. TABLE : reviews
   - RLS : ACTIV√â
   - Politiques :
     * "Reviews are viewable by everyone" (SELECT) : Avis visibles par tous
     * "Users can insert own reviews" (INSERT) : Utilisateurs peuvent cr√©er leurs avis
     * "Users can update own reviews" (UPDATE) : Utilisateurs peuvent modifier leurs avis
     * "Users can delete own reviews" (DELETE) : Utilisateurs peuvent supprimer leurs avis

üí¨ TABLES DE MESSAGERIE
-----------------------

10. TABLE : conversations
    - RLS : ACTIV√â
    - Politiques :
      * "Users can view own conversations" (SELECT) : Utilisateurs voient leurs conversations
      * "Users can insert own conversations" (INSERT) : Utilisateurs peuvent cr√©er des conversations
      * "Users can update own conversations" (UPDATE) : Utilisateurs peuvent modifier leurs conversations
      * "Users can delete own conversations" (DELETE) : Utilisateurs peuvent supprimer leurs conversations

11. TABLE : conversation_participants
    - RLS : ACTIV√â
    - Politiques :
      * "Users can view conversation participants" (SELECT) : Participants visibles aux membres
      * "Users can insert conversation participants" (INSERT) : Ajout de participants autoris√©
      * "Users can delete conversation participants" (DELETE) : Suppression de participants autoris√©e

12. TABLE : messages
    - RLS : ACTIV√â
    - Politiques :
      * "Users can view conversation messages" (SELECT) : Messages visibles aux participants
      * "Users can insert own messages" (INSERT) : Utilisateurs peuvent envoyer des messages
      * "Users can update own messages" (UPDATE) : Utilisateurs peuvent modifier leurs messages
      * "Users can delete own messages" (DELETE) : Utilisateurs peuvent supprimer leurs messages

üîî TABLES SYST√àME
-----------------

13. TABLE : notifications
    - RLS : ACTIV√â
    - Politiques :
      * "Users can view own notifications" (SELECT) : Utilisateurs voient leurs notifications
      * "Users can update own notifications" (UPDATE) : Utilisateurs peuvent marquer comme lues
      * "System can insert notifications" (INSERT) : Le syst√®me peut cr√©er des notifications
      * "Users can delete own notifications" (DELETE) : Utilisateurs peuvent supprimer leurs notifications

14. TABLE : subscriptions
    - RLS : ACTIV√â
    - Politiques :
      * "Users can view own subscriptions" (SELECT) : Utilisateurs voient leurs abonnements
      * "Users can insert own subscriptions" (INSERT) : Utilisateurs peuvent s'abonner
      * "Users can update own subscriptions" (UPDATE) : Utilisateurs peuvent modifier leurs abonnements
      * "Users can delete own subscriptions" (DELETE) : Utilisateurs peuvent se d√©sabonner

üì¢ TABLES DE PUBLICIT√âS
-----------------------

15. TABLE : advertisements
    - RLS : ACTIV√â
    - Politiques :
      * "Active advertisements are viewable by everyone" (SELECT) : Publicit√©s actives visibles par tous
      * "Users can insert own advertisements" (INSERT) : Utilisateurs peuvent cr√©er leurs publicit√©s
      * "Users can update own advertisements" (UPDATE) : Utilisateurs peuvent modifier leurs publicit√©s
      * "Users can delete own advertisements" (DELETE) : Utilisateurs peuvent supprimer leurs publicit√©s

16. TABLE : advertisement_impressions
    - RLS : ACTIV√â
    - Politiques :
      * "Anyone can insert impressions" (INSERT) : Tracking des impressions autoris√©
      * "Ad owners can view their impressions" (SELECT) : Propri√©taires voient leurs stats

17. TABLE : advertisement_clicks
    - RLS : ACTIV√â
    - Politiques :
      * "Anyone can insert clicks" (INSERT) : Tracking des clics autoris√©
      * "Ad owners can view their clicks" (SELECT) : Propri√©taires voient leurs stats

=================================================================
                    BUCKETS DE STOCKAGE S√âCURIS√âS
=================================================================

üóÇÔ∏è POLITIQUES POUR TOUS LES BUCKETS

1. BUCKET : marketplace_images
   - Type : Public
   - Politiques :
     * "Public images are viewable by everyone" (SELECT) : Images visibles par tous
     * "Authenticated users can upload marketplace images" (INSERT) : Upload pour utilisateurs authentifi√©s
     * "Users can update own marketplace images" (UPDATE) : Modification des propres images
     * "Users can delete own marketplace images" (DELETE) : Suppression des propres images

2. BUCKET : post-images
   - Type : Public
   - Politiques :
     * "Post images are viewable by everyone" (SELECT) : Images de posts visibles par tous
     * "Authenticated users can upload post images" (INSERT) : Upload pour utilisateurs authentifi√©s
     * "Users can update own post images" (UPDATE) : Modification des propres images
     * "Users can delete own post images" (DELETE) : Suppression des propres images

3. BUCKET : announcements-images
   - Type : Public
   - Politiques :
     * "Announcement images are viewable by everyone" (SELECT) : Images d'annonces visibles par tous
     * "Authenticated users can upload announcement images" (INSERT) : Upload pour utilisateurs authentifi√©s
     * "Users can update own announcement images" (UPDATE) : Modification des propres images
     * "Users can delete own announcement images" (DELETE) : Suppression des propres images

4. BUCKET : services-images
   - Type : Public
   - Politiques :
     * "Service images are viewable by everyone" (SELECT) : Images de services visibles par tous
     * "Authenticated users can upload service images" (INSERT) : Upload pour utilisateurs authentifi√©s
     * "Users can update own service images" (UPDATE) : Modification des propres images
     * "Users can delete own service images" (DELETE) : Suppression des propres images

=================================================================
                    FONCTIONS S√âCURIS√âES
=================================================================

üîß CORRECTION DES SEARCH_PATH MUTABLES

Toutes les fonctions suivantes ont √©t√© s√©curis√©es avec search_path = '' :

1. increment_product_views(uuid)
   - Fonction pour incr√©menter les vues des produits
   - Search_path s√©curis√© : ‚úÖ

2. increment_advertisement_views(uuid)
   - Fonction pour incr√©menter les vues des publicit√©s
   - Search_path s√©curis√© : ‚úÖ

3. increment_advertisement_clicks(uuid)
   - Fonction pour incr√©menter les clics des publicit√©s
   - Search_path s√©curis√© : ‚úÖ

4. handle_new_user()
   - Fonction pour g√©rer les nouveaux utilisateurs
   - Search_path s√©curis√© : ‚úÖ

5. update_updated_at_column()
   - Fonction pour mettre √† jour les timestamps
   - Search_path s√©curis√© : ‚úÖ

6. update_advertisement_stats()
   - Fonction pour mettre √† jour les statistiques des publicit√©s
   - Search_path s√©curis√© : ‚úÖ

=================================================================
                    MIGRATIONS APPLIQU√âES
=================================================================

üìù LISTE DES MIGRATIONS EX√âCUT√âES :

1. enable_rls_profiles_policies
   - Activation RLS et politiques pour la table profiles

2. enable_rls_announcements_policies
   - Activation RLS et politiques pour la table announcements

3. enable_rls_favorites_policies
   - Activation RLS et politiques pour la table favorites

4. enable_rls_reviews_policies
   - Activation RLS et politiques pour la table reviews

5. enable_rls_messaging_policies
   - Activation RLS et politiques pour les tables de messagerie
   - (conversations, conversation_participants, messages)

6. enable_rls_community_policies_safe
   - Activation RLS et politiques pour les tables de communaut√©
   - (posts, comments, likes)

7. enable_rls_categories_policies
   - Activation RLS et politiques pour la table categories

8. enable_rls_advertisements_policies
   - Activation RLS et politiques pour les tables de publicit√©s
   - (advertisements, advertisement_impressions, advertisement_clicks)

9. enable_storage_rls_policies
   - Activation des politiques RLS pour tous les buckets de stockage

10. fix_remaining_rls_issues
    - Correction des derniers probl√®mes RLS
    - (products, notifications, subscriptions)

11. fix_function_search_paths
    - Correction des search_path mutables pour toutes les fonctions

=================================================================
                    V√âRIFICATIONS DE S√âCURIT√â
=================================================================

‚úÖ PROBL√àMES R√âSOLUS :
- Toutes les tables publiques ont maintenant RLS activ√©
- Toutes les politiques manquantes ont √©t√© cr√©√©es
- Tous les search_path mutables ont √©t√© corrig√©s
- Tous les buckets de stockage sont s√©curis√©s

‚ö†Ô∏è  AVERTISSEMENTS RESTANTS (non critiques) :
- Protection contre les mots de passe compromis d√©sactiv√©e
- Options MFA insuffisantes

Ces avertissements concernent la configuration d'authentification
et peuvent √™tre activ√©s dans les param√®tres Supabase Auth si souhait√©.

=================================================================
                    RECOMMANDATIONS FUTURES
=================================================================

üîê S√âCURIT√â SUPPL√âMENTAIRE :
1. Activer la protection contre les mots de passe compromis
2. Configurer des options MFA suppl√©mentaires
3. Mettre en place des politiques d'administration pour les cat√©gories
4. Surveiller r√©guli√®rement les logs de s√©curit√©

üìä MONITORING :
1. V√©rifier p√©riodiquement les conseillers de s√©curit√© Supabase
2. Auditer les politiques RLS lors d'ajouts de nouvelles tables
3. Tester les permissions avec diff√©rents types d'utilisateurs

=================================================================
                        FIN DU DOCUMENT
=================================================================

Ce document constitue la documentation compl√®te de la s√©curit√©
RLS mise en place pour l'application Guyane Marketplace.

Tous les √©l√©ments critiques de s√©curit√© sont maintenant en place
et l'application est pr√™te pour la production.

Date de derni√®re mise √† jour : D√©cembre 2024